--- /usr/lib/python2.7/dist-packages/lava_dispatcher/protocols/xnbd.py.old	2017-12-12 10:18:00.377431519 +0000
+++ /usr/lib/python2.7/dist-packages/lava_dispatcher/protocols/xnbd.py	2017-12-12 10:18:11.165370822 +0000
@@ -66,7 +66,7 @@
         # shutdown xnbd for the given device/job based in the port-number used
         try:
             self.logger.debug("%s cleanup", self.name)
-            self.port = self.parameters['protocols']['lava-xnbd']['port']
+            self.port = self.parameters['actions'][0].items()[0][1]['lava-xnbd']['port']
             nbd_cmd = "pkill -f xnbd-server.*%s" % (self.port)
             shell = ShellCommand("%s\n" % nbd_cmd, self.system_timeout,
                                  logger=self.logger)

